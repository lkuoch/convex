# Convert to Monorepo with Bun Workspaces

## Overview

Convert current single-package Convex + React project into a monorepo with:

- `apps/web` - Frontend React application (Vite)
- `apps/backend` - Convex backend functions
- `packages/common` - Shared utilities and types

## Implementation Steps

### 1. Create Monorepo Structure

Create new directory structure:

```
law/
├── apps/
│   ├── web/          (from src/)
│   └── backend/      (from convex/)
├── packages/
│   └── common/
├── package.json       (root monorepo config)
└── bun.lockb
```

**Files to create:**

- `apps/web/package.json` - Frontend app package
- `apps/backend/package.json` - Backend app package
- `packages/common/package.json` - Shared utilities package
- Root `package.json` with workspaces configuration

### 2. Move Frontend to apps/web

**Move:**

- `src/` → `apps/web/src/`
- `index.html` → `apps/web/index.html`
- `vite.config.ts` → `apps/web/vite.config.ts`
- `public/` → `apps/web/public/`
- `src/vite-env.d.ts` → `apps/web/src/vite-env.d.ts`

**Update `apps/web/package.json`:**

- Name: `@law/web`
- Dependencies: react, react-dom, convex, better-auth, @convex-dev/better-auth
- Scripts: dev, build, preview
- Path alias `@/*` → `./src/*`

**Update `apps/web/vite.config.ts`:**

- Update relative paths for index.html and public dir

### 3. Move Backend to apps/backend

**Move:**

- `convex/` → `apps/backend/convex/`
- `.env.local` → `apps/backend/.env.local`

**Update `apps/backend/package.json`:**

- Name: `@law/backend`
- Dependencies: convex, better-auth, @convex-dev/better-auth
- Scripts: dev, generate (for convex types)
- Add `@types/node` dev dependency

### 4. Create packages/common

**Create:**

- `packages/common/package.json` - Shared utilities
- `packages/common/src/` - Shared source files
- Initial content: Export types, constants, utilities (minimal for now)

**Files to create:**

- `packages/common/src/index.ts` - Main entry point
- `packages/common/tsconfig.json` - TypeScript config for package

### 5. Update Root Configuration

**Root `package.json`:**

- Add Bun workspaces configuration: `"workspaces": ["apps/*", "packages/*"]`
- Scripts:
  - `dev` - Run both apps in parallel
  - `dev:web` - Start web app
  - `dev:backend` - Start backend
  - `build` - Build all packages
  - `lint` - Lint all packages
  - `clean` - Clean node_modules and dist

**Update `tsconfig.json`:**

- Add references to workspace packages
- Update paths for monorepo structure

### 6. Update Import Paths

**In apps/web:**

- `@/*` → `./src/*` (no change needed)
- Add `@law/common/*` → `../../packages/common/src/*`

**In apps/backend:**

- Convex paths remain same (`./_generated/api`, etc.)
- Add `@law/common/*` → `../../packages/common/src/*`

### 7. Update Configuration Files

**ESLint (`eslint.config.js`):**

- Update to handle monorepo structure
- Add ignores for `node_modules`, `dist`, `.turbo`, etc.

**TypeScript configs:**

- Root: `tsconfig.json` with project references
- `apps/web/tsconfig.json` - App-specific config
- `apps/backend/tsconfig.json` - Backend-specific config
- `packages/common/tsconfig.json` - Shared package config

**Vite config (apps/web/vite.config.ts):**

- Update paths for monorepo structure
- Ensure proper aliasing for `@/*` and `@law/common/*`

### 8. Migrate Environment Variables

**Update `.env.local` location:**

- Keep in root: `.env.local`
- Or keep in `apps/backend/.env.local` (backend-specific)

### 9. Update Scripts

**Root `package.json` scripts:**

```json
{
  "scripts": {
    "dev": "bun run --filter '*' dev",
    "dev:web": "cd apps/web && bun run dev",
    "dev:backend": "cd apps/backend && bun run dev",
    "build": "bun run --filter '*' build",
    "lint": "bun run --filter '*' lint",
    "clean": "rm -rf node_modules apps/*/node_modules packages/*/node_modules"
  }
}
```

**apps/web/package.json scripts:**

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview",
    "lint": "tsc && eslint . --ext ts,tsx"
  }
}
```

**apps/backend/package.json scripts:**

```json
{
  "scripts": {
    "dev": "convex dev",
    "lint": "tsc --project tsconfig.json"
  }
}
```

## Critical Files to Modify

1. **Root:** `package.json`, `tsconfig.json`, `eslint.config.js`, `.gitignore`
2. **apps/web:** `package.json`, `vite.config.ts`, `tsconfig.json`
3. **apps/backend:** `package.json`, `tsconfig.json`, `.env.local`
4. **packages/common:** `package.json`, `tsconfig.json`, `src/index.ts`
5. **Configuration:** Update imports in `apps/web/src/**/*.tsx`, `apps/backend/convex/**/*.ts`

## Verification

### 1. Install Dependencies

```bash
bun install
```

Should install dependencies for all workspace packages.

### 2. Run Linting

```bash
bun run lint
```

Should lint all packages successfully.

### 3. Run Development

```bash
bun run dev
```

Should start both web and backend concurrently.

### 4. Test Build

```bash
bun run build
```

Should build all packages.

### 5. Test Import Paths

Create a shared utility in `packages/common/src/` and import from both apps.

## Migration Notes

- **Preserve Convex deployment**: The `CONVEX_DEPLOYMENT` env var ensures same backend
- **Environment variables**: Keep Google OAuth credentials in `.env.local`
- **Git history**: Files are moved, use `git mv` to preserve history
- **Build artifacts**: Add `dist/`, `.turbo/` to `.gitignore`
- **Linux environment**: All commands use standard Linux/Bun syntax, no UI tools needed
